# from mailbox import Message

import aiohttp
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, Message
from aiogram.filters import Command
import asyncio

API_TOKEN = '8235111912:AAG3xpO4KTixEa_X7B7iIJjEDDX5Jr0-fdM'
API_URL = 'http://127.0.0.1:8000/api/courses/'

bot = Bot(token=API_TOKEN)
dp = Dispatcher()


async def get_courses(title_id):
    async with aiohttp.ClientSession() as session:
        base_url = f'{API_URL}?id__gte={title_id}'
        async with session.get(base_url) as response:
            return await response.json()


@dp.message(Command('start'))
async def start(message: types.Message):
    user_id = message.from_user.id
    info_api = await get_courses(title_id=2)
    # print(info_api)
    buttons = []
    for info in info_api:
        print(info['title'])
        buttons.append([types.KeyboardButton(text = info['title'])])
    keyboard = types.ReplyKeyboardMarkup(keyboard=buttons, resize_keyboard=True)
    await message.answer('Choose a course:', reply_markup=keyboard)

async def main():
    await dp.start_polling(bot)


print('The bot is running...')
asyncio.run(main())




